<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon">
  <title>Manage Residents | Edensight</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <!-- SweetAlert2 -->
  <link rel="stylesheet" href="plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css">
  <!-- Toastr -->
  <link rel="stylesheet" href="plugins/toastr/toastr.min.css">
  <!-- Extra stylesheet -->
  <link rel="stylesheet" href="style.css">
  <!-- Extra javascript -->
  <script src="main.js"></script>
  <script src="validation.js"></script>
</head>
<body class="hold-transition sidebar-mini">
  <div class="wrapper">

    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
          <a href="#" onclick="getAllResidents()" class="nav-link">Refresh List</a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
          <a href="#" class="nav-link" data-toggle="modal" data-target="#newResidentModal">New Resident</a>
        </li>
      </ul>

      <p class="lead welcomeMsg col">Welcome back, <b id="uname">Traveler</b>!</p>
    </nav>
    <!-- /.navbar -->

    <!-- Main Sidebar Container -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
      <!-- Brand Logo -->
      <a href="" class="brand-link">
        <img src="assets/eden-logo-white+grey.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
        <span class="brand-text font-weight-light">Edensight</span>
      </a>

      <!-- Sidebar -->
      <div class="sidebar">

        <!-- Sidebar Menu -->
        <nav class="mt-2">
          <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
            <!-- Add icons to the links using the .nav-icon class
            with font-awesome or any other icon font library -->
            <li class="nav-item">
              <a href="login.html" onclick="localStorage.removeItem('credentials')" class="nav-link">
                <p>
                  Log Out
                </p>
              </a>
            </li>
            <li class="nav-header">ADMIN</li>
            <li class="nav-item">
              <a href="adminResidents.html" class="nav-link active">
                <i class="nav-icon fas fa-users"></i>
                <p>
                  Residents
                </p>
              </a>

            </li>
            <li class="nav-item">
              <a href="adminStaff.html" class="nav-link">
                <i class="nav-icon fas fa-user-tie"></i>
                <p>
                  Staff
                </p>
              </a>
            </li>
            <li class="nav-header">STAFF</li>
            <li class="nav-item">
              <a href="residents.html" class="nav-link">
                <i class="nav-icon fas fa-users"></i>
                <p>
                  Residents
                </p>
              </a>

            </li>
          </ul>
        </nav>
        <!-- /.sidebar-menu -->
      </div>
      <!-- /.sidebar -->
    </aside>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <div class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1 class="m-0 text-dark">Manage Residents</h1>
            </div><!-- /.col -->
          </div><!-- /.row -->
        </div><!-- /.container-fluid -->
      </div>
      <!-- /.content-header -->

      <!-- Main content -->
      <div class="content">
        <div class="container-fluid">
          <div class="row">
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <table id="residents_table" class="table table-bordered table-hover">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Caretaker</th>
                        <th>Room</th>
                      </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <tfoot>
                      <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Caretaker</th>
                        <th>Room</th>
                      </tr>
                    </tfoot>
                  </table>
                </div>
                <!-- /.card-body -->
              </div>
              <!-- /.card -->
            </div>
            <!-- /.col -->
          </div>
          <!-- /.row -->
        </div><!-- /.container-fluid -->
      </div>
      <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->

    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
      <!-- Control sidebar content goes here -->
      <div class="p-3">
        <h5>Title</h5>
        <p>Sidebar content</p>
      </div>
    </aside>
    <!-- /.control-sidebar -->

    <!-- Main Footer -->
    <footer class="main-footer">
      <!-- To the right -->
      <div class="float-right d-none d-sm-inline">
        created by WeebTeam :)
      </div>
      <!-- Default to the left -->
      <strong>Copyright &copy; 2014-2020 <a href="https://adminlte.io">AdminLTE.io</a>.</strong> All rights reserved.
    </footer>
  </div>
  <!-- ./wrapper -->

  <!-- Modals -->
  <div class="modal fade" id="newResidentModal" tabindex="-1" aria-labelledby="NewResidentModal" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add New Resident</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="row">
          <div class="col-12 col-sm-12">
            <div class="card card-primary card-tabs">
              <div class="card-header p-0 pt-1">
                <ul class="nav nav-tabs" id="custom-tabs-one-tab" role="tablist">
                  <li class="nav-item">
                    <a class="nav-link active" id="custom-tabs-one-newGeneral-tab" data-toggle="pill" href="#custom-tabs-one-newGeneral" role="tab" aria-controls="custom-tabs-one-newGeneral" aria-selected="true">General</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="custom-tabs-one-newDetailed-tab" data-toggle="pill" href="#custom-tabs-one-newDetailed" role="tab" aria-controls="custom-tabs-one-newDetailed" aria-selected="false">Details</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="custom-tabs-one-newHealth-tab" data-toggle="pill" href="#custom-tabs-one-newHealth" role="tab" aria-controls="custom-tabs-one-newHealth" aria-selected="false">Health</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="custom-tabs-one-newContact-tab" data-toggle="pill" href="#custom-tabs-one-newContact" role="tab" aria-controls="custom-tabs-one-newContact" aria-selected="false">Contact</a>
                  </li>
                </ul>
              </div>
              <form id='new_resident_form' novalidate="">
                <div class="card-body">
                  <div class="tab-content" id="custom-tabs-one-tabContent">
                    <div class="tab-pane fade show active" id="custom-tabs-one-newGeneral" role="tabpanel" aria-labelledby="custom-tabs-one-newGeneral-tab">
                      <div class="modal-body">
                        <div class="form-group">
                          <label for="newResidentName"><span class="asterisk">* </span>Resident Name</label>
                          <input type="text" class="form-control" id="newResidentName" required="">
                        </div>
                        <div class="form-group">
                          <label for="newResidentCaretaker"><span class="asterisk">* </span>Caretaker</label>
                          <select class="form-control" id="newResidentCaretaker">
                          </select>
                        </div>
                        <div class="form-group">
                          <label for="newResidentRoom"><span class="asterisk">* </span>Room Number</label>
                          <input type="text" class="form-control" id="newResidentRoom" required="">
                        </div>
                        <div class="form-group">
                          <label for="newResidentDeviceAddr">Device MAC Address
                            <br><span class="help">E.g. xx:xx:xx:xx:xx:xx</span>
                          </label>
                          <input type="text" class="form-control" id="newResidentDeviceAddr">
                        </div>
                      </div>
                    </div>
                    <div class="tab-pane fade" id="custom-tabs-one-newDetailed" role="tabpanel" aria-labelledby="custom-tabs-one-newDetailed-tab">
                      <div class="modal-body">
                        <div class="form-group">
                          <label for="newResidentGender">Gender</label>
                          <select class="form-control" id="newResidentGender" required="">
                            <option>Male</option>
                            <option>Female</option>
                            <option>Other</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <label for="newResidentDOB"><span class="asterisk">* </span>Date of birth</label>
                          <input type="date" class="form-control" id="newResidentDOB" required="">
                        </div>
                        <div class="form-group">
                          <label for="newResidentIC"><span class="asterisk">* </span>IC No.
                            <br><span class="help">E.g. 950827088754</span>
                          </label>
                          <input type="text" class="form-control" id="newResidentIC" required="">
                        </div>
                        <div class="form-group">
                          <label for="newResidentNationality"><span class="asterisk">* </span>Nationality</label>
                          <input type="text" class="form-control" id="newResidentNationality" required="">
                        </div>
                      </div>
                    </div>
                    <div class="tab-pane fade" id="custom-tabs-one-newHealth" role="tabpanel" aria-labelledby="custom-tabs-one-newHealth-tab">
                      <div class="modal-body">
                        <div class="form-group">
                          <label for="newResidentWeight"><span class="asterisk">* </span>Weight (kg)
                            <br><span class="help">Please enter 2 or 3 digits</span>
                          </label>
                          <input type="text" class="form-control" id="newResidentWeight" pattern="[\d]{2,3}" required="">
                        </div>
                        <div class="form-group">
                          <label for="newResidentHeight"><span class="asterisk">* </span>Height (cm)
                            <br><span class="help">Please enter 2 or 3 digits</span>
                          </label>
                          <input type="text" class="form-control" id="newResidentHeight" pattern="[\d]{2,3}" required="">
                        </div>
                        <div class="form-group">
                          <label for="newResidentBloodType"><span class="asterisk">* </span>Blood Type</label>
                          <select class="form-control" id="newResidentBloodType" required="">
                            <option>A</option>
                            <option>B</option>
                            <option>AB</option>
                            <option>O</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <label>Health Conditions</label><br>

                          <div id="healthConditions-new">
                            <div class="card-body">
                              <div class="input-group">
                                <input id="new-condition-new" type="text" class="form-control" placeholder="Health Conditions (Diabetes, Stroke, etc)">

                                <div class="input-group-append">
                                  <button id="add-new-condition-new" type="button" class="btn btn-primary">Add</button>
                                </div>
                                <!-- /btn-group -->
                              </div>
                              <!-- /input-group -->
                            </div>
                          </div>
                        </div>

                        <div class="form-group">
                          <label>Allergies</label><br>

                          <div id="allergies-new">
                            <div class="card-body">
                              <div class="input-group">
                                <input id="new-allergies-new" type="text" class="form-control" placeholder="Allergies (Drugs, etc)">

                                <div class="input-group-append">
                                  <button id="add-new-allergies-new" type="button" class="btn btn-primary">Add</button>
                                </div>
                                <!-- /btn-group -->
                              </div>
                              <!-- /input-group -->
                            </div>
                          </div>
                        </div>
                        <div class="form-group">
                          <label>Medication</label><br>

                          <div id="medication-new">
                            <div class="card-body">
                              <div class="input-group">
                                <input id="new-medication-new" type="text" class="form-control" placeholder="Medication">

                                <div class="input-group-append">
                                  <button id="add-new-medication-new" type="button" class="btn btn-primary">Add</button>
                                </div>
                                <!-- /btn-group -->
                              </div>
                              <!-- /input-group -->
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="tab-pane fade" id="custom-tabs-one-newContact" role="tabpanel" aria-labelledby="custom-tabs-one-newContact-tab">
                      <div class="modal-body">
                        <div class="form-group">
                          <label for="newResidentPNum"><span class="asterisk">* </span>Resident's Phone Number
                            <br><span class="help">E.g. 0101234567</span>
                          </label>
                          <input type="text" class="form-control" id="newResidentPNum" required="">
                        </div>
                        <div class="form-group">
                          <label for="newResidentGuardian"><span class="asterisk">* </span>Guardian's Name</label>
                          <input type="text" class="form-control" id="newResidentGuardian" required="">
                        </div>
                        <div class="form-group">
                          <label for="newResidentEmergencyPNum"><span class="asterisk">* </span>Emergency Phone Number
                            <br><span class="help">E.g. 0101234567</span>
                          </label>
                          <input type="text" class="form-control" id="newResidentEmergencyPNum" required="">
                        </div>
                        <div class="form-group">
                          <label for="newResidentStreetAddress"><span class="asterisk">* </span>Street Address</label>
                          <input type="text" class="form-control" id="newResidentStreetAddress" required="">
                        </div>
                        <div class="form-group">
                          <label for="newResidentStreetAddress2"><span class="asterisk">* </span>Street Address 2</label>
                          <input type="text" class="form-control" id="newResidentStreetAddress2" required="">
                        </div>
                        <div class="form-row">
                          <div class="form-group col-md-5">
                            <label for="newResidentCity"><span class="asterisk">* </span>City</label>
                            <input type="text" class="form-control" id="newResidentCity" required="">
                          </div>
                          <div class="form-group col-md-4">
                            <label for="newResidentState"><span class="asterisk">* </span>State</label>
                            <input type="text" class="form-control" id="newResidentState" required="">
                          </div>
                          <div class="form-group col-md-3">
                            <label for="newResidentPostal"><span class="asterisk">* </span>Postal</label>
                            <input type="text" class="form-control" id="newResidentPostal" required="">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- /.card -->
                <div class="modal-footer">
                  <button type="reset" class="btn btn-danger" onclick="return confirm_reset();">Clear</button>
                  <button type="submit" class="btn btn-primary">Submit</button>
                </div>
              </form>
              <!-- /.END OF FORM -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="residentModal" tabindex="-1" aria-labelledby="ResidentModal" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="residentModalTitle" >Resident Details</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="row">
          <div class="col-12 col-sm-12">
            <div class="card card-primary card-tabs">
              <div class="card-header p-0 pt-1">
                <ul class="nav nav-tabs" id="custom-tabs-one-tab" role="tablist">
                  <li class="nav-item">
                    <a class="nav-link active" id="custom-tabs-one-home-tab" data-toggle="pill" href="#custom-tabs-one-home" role="tab" aria-controls="custom-tabs-one-home" aria-selected="true">General</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="custom-tabs-one-detailed-tab" data-toggle="pill" href="#custom-tabs-one-detailed" role="tab" aria-controls="custom-tabs-one-detailed" aria-selected="false">Details</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="custom-tabs-one-health-tab" data-toggle="pill" href="#custom-tabs-one-health" role="tab" aria-controls="custom-tabs-one-health" aria-selected="false">Health</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="custom-tabs-one-contact-tab" data-toggle="pill" href="#custom-tabs-one-contact" role="tab" aria-controls="custom-tabs-one-contact" aria-selected="false">Contact</a>
                  </li>
                </ul>
              </div>
              <form id='update_resident_form' novalidate="">
                <div class="card-body">
                  <div class="tab-content" id="custom-tabs-one-tabContent">
                    <!-- general tab  -->
                    <div class="tab-pane fade show active" id="custom-tabs-one-home" role="tabpanel" aria-labelledby="custom-tabs-one-home-tab">
                      <div class="modal-body">
                        <div class="form-group">
                          <label for="residentID"><span class="asterisk">* </span>Resident ID</label>
                          <input type="text" class="form-control" id="residentID" required="" disabled="">
                        </div>
                        <div class="form-group">
                          <label for="residentName"><span class="asterisk">* </span>Resident Name</label>
                          <input type="text" class="form-control" id="residentName" required="" disabled="">
                        </div>
                        <div class="form-group">
                          <label for="residentCaretaker"><span class="asterisk">* </span>Caretaker</label>
                          <select class="form-control" id="residentCaretaker" disabled="">
                          </select>
                        </div>
                        <div class="form-group">
                          <label for="residentRoom"><span class="asterisk">* </span>Room Number</label>
                          <input type="text" class="form-control" id="residentRoom" required="" disabled="">
                        </div>
                        <div class="form-group">
                          <label for="residentDeviceAddr">Device MAC Address
                            <br><span class="help">E.g. xx:xx:xx:xx:xx:xx</span>
                          </label>
                          <input type="text" class="form-control" id="residentDeviceAddr" disabled="">
                        </div>
                      </div>
                    </div>

                    <!-- details tab  -->
                    <div class="tab-pane fade" id="custom-tabs-one-detailed" role="tabpanel" aria-labelledby="custom-tabs-one-detailed-tab">
                      <div class="modal-body">
                        <div class="form-group">
                          <label for="residentGender"><span class="asterisk">* </span>Gender</label>
                          <select class="form-control" id="residentGender" required="" disabled="">
                            <option>Male</option>
                            <option>Female</option>
                            <option>Other</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <label for="residentDOB"><span class="asterisk">* </span>Date of birth</label>
                          <input type="date" class="form-control" id="residentDOB" required="" disabled="">
                        </div>
                        <div class="form-group">
                          <label for="residentIC"><span class="asterisk">* </span>IC No.
                            <br><span class="help">E.g. 950827088754</span>
                          </label>
                          <input type="text" class="form-control" id="residentIC" required="" disabled="">
                        </div>
                        <div class="form-group">
                          <label for="residentNationality"><span class="asterisk">* </span>Nationality</label>
                          <input type="text" class="form-control" id="residentNationality" required="" disabled="">
                        </div>
                      </div>
                    </div>

                    <!-- health tab  -->
                    <div class="tab-pane fade" id="custom-tabs-one-health" role="tabpanel" aria-labelledby="custom-tabs-one-health-tab">
                      <div class="modal-body">
                        <div class="form-group">
                          <label for="residentWeight"><span class="asterisk">* </span>Weight (kg)
                            <br><span class="help">Please enter 2 or 3 digits</span>
                          </label>
                          <input type="text" class="form-control" id="residentWeight" pattern="[\d]{2,3}" required="" disabled="">
                        </div>
                        <div class="form-group">
                          <label for="residentHeight"><span class="asterisk">* </span>Height (cm)
                            <br><span class="help">Please enter 2 or 3 digits</span>
                          </label>
                          <input type="text" class="form-control" id="residentHeight" pattern="[\d]{2,3}" required="" disabled="">
                        </div>
                        <div class="form-group">
                          <label for="residentBloodType"><span class="asterisk">* </span>Blood Type</label>
                          <select class="form-control" id="residentBloodType" required="" disabled="">
                            <option>A</option>
                            <option>B</option>
                            <option>AB</option>
                            <option>O</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <label>Health Conditions</label><br>
                          <div id="healthConditions">
                            <div class="card-body">
                              <div class="input-group">
                                <input id="new-condition" type="text" class="form-control" placeholder="Health Conditions (Diabetes, Stroke, etc)">
                                <div class="input-group-append">
                                  <button id="add-new-condition" type="button" class="btn btn-primary" disabled="">Add</button>
                                </div>
                              </div>
                              <!-- /input-group -->
                            </div>
                          </div>
                        </div>
                        <div class="form-group">
                          <label>Allergies</label><br>
                          <div id="allergies">
                            <div class="card-body">
                              <div class="input-group">
                                <input id="new-allergies" type="text" class="form-control" placeholder="Allergies (Drugs, etc)">
                                <div class="input-group-append">
                                  <button id="add-new-allergies" type="button" class="btn btn-primary" disabled="">Add</button>
                                </div>
                              </div>
                              <!-- /input-group -->
                            </div>
                          </div>
                        </div>
                        <div class="form-group">
                          <label>Medication</label><br>
                          <div id="medication">
                            <div class="card-body">
                              <div class="input-group">
                                <input id="new-medication" type="text" class="form-control" placeholder="Medication">
                                <div class="input-group-append">
                                  <button id="add-new-medication" type="button" class="btn btn-primary" disabled="">Add</button>
                                </div>
                              </div>
                              <!-- /input-group -->
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="tab-pane fade" id="custom-tabs-one-contact" role="tabpanel" aria-labelledby="custom-tabs-one-contact-tab">
                      <div class="modal-body">
                        <div class="form-group">
                          <label for="residentPNum"><span class="asterisk">* </span>Resident's Phone Number
                            <br><span class="help">E.g. 0101234567</span>
                          </label>
                          <input type="text" class="form-control" id="residentPNum" required="" disabled="">
                        </div>
                        <div class="form-group">
                          <label for="residentGuardian"><span class="asterisk">* </span>Guardian's Name</label>
                          <input type="text" class="form-control" id="residentGuardian" required="" disabled="">
                        </div>
                        <div class="form-group">
                          <label for="residentEmergencyPNum"><span class="asterisk">* </span>Emergency Phone Number
                            <br><span class="help">E.g. 0101234567</span>
                          </label>
                          <input type="text" class="form-control" id="residentEmergencyPNum" required="" disabled="">
                        </div>
                        <div class="form-group">
                          <label for="residentStreetAddress"><span class="asterisk">* </span>Street Address</label>
                          <input type="text" class="form-control" id="residentStreetAddress" required="" disabled="">
                        </div>
                        <div class="form-group">
                          <label for="residentStreetAddress2"><span class="asterisk">* </span>Street Address 2</label>
                          <input type="text" class="form-control" id="residentStreetAddress2" required="" disabled="">
                        </div>
                        <div class="form-row">
                          <div class="form-group col-md-5">
                            <label for="residentCity"><span class="asterisk">* </span>City</label>
                            <input type="text" class="form-control" id="residentCity" required="" disabled="">
                          </div>
                          <div class="form-group col-md-4">
                            <label for="residentState"><span class="asterisk">* </span>State</label>
                            <input type="text" class="form-control" id="residentState" required="" disabled="">
                          </div>
                          <div class="form-group col-md-3">
                            <label for="residentPostal"><span class="asterisk">* </span>Postal</label>
                            <input type="text" class="form-control" id="residentPostal" required="" disabled="">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- /.card -->
                <!-- /.END OF FORM -->
                <div class="modal-footer" id="residentModalFooter">
                  <button type="button" class="btn btn-primary" onclick="enableUpdateResident()">Modify Resident</button>
                  <button type="button" class="btn btn-danger" onclick="deleteResident()">Delete Resident</button>
                </div>
                <div class="modal-footer" id="updateResidentFooter" style="display:none;">
                  <button type="button" class="btn btn-secondary" onclick="cancelUpdateResident()">Cancel</button>
                  <button type="submit" class="btn btn-info">Update Resident</button>
                </div>
              </form>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="unauthorized_modal" tabindex="-1" aria-labelledby="UnauthorizedModal" aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Unauthorized</h5>
        </div>
        <div class="modal-body">
          <p>You are not authorized to access this page or perform this operation.</p>
          <p>Please click the button below to log in, or log out and log in again as an authorized user.</p>
        </div>
        <div class="modal-footer">
          <a class="btn btn-primary" href="login.html">Log in</a>
        </div>
      </div>
    </div>
  </div>

  <!-- REQUIRED SCRIPTS -->

  <!-- jQuery -->
  <script src="plugins/jquery/jquery.min.js"></script>
  <!-- Bootstrap 4 -->
  <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <!-- AdminLTE App -->
  <script src="dist/js/adminlte.min.js"></script>

  <!-- DataTables -->
  <script src="plugins/datatables/jquery.dataTables.min.js"></script>
  <script src="plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
  <script src="plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
  <script src="plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>

  <!-- SweetAlert2 -->
  <script src="plugins/sweetalert2/sweetalert2.min.js"></script>
  <!-- Toastr -->
  <script src="plugins/toastr/toastr.min.js"></script>


  <!-- page script -->
  <script>
  $(function () { //stuff here runs on page load

    //populate uname
    $("#uname").text(localStorage.getItem("uname"));

    //init residents table
    residents_table = $('#residents_table').DataTable({
      "paging": true,
      "ordering": true,
      "info": true,
      "autoWidth": false,
      "responsive": true,
      "columns": [
        { "data": "_id" },
        { "data": "name" },
        { "data": "caretakerName" },
        { "data": "room" }
      ]
    });

    //init resident (blank for now)
    resident = ""

    //list to store caretakers and their names
    caretakerList = [];

    //fetch any data that we need on page load
    getCaretakers(); //load this first as we need data from it to populate residents table
    getAllResidents();

    //test
    //testDetailsForms();
  });

  /********** event listeners **********/

  //submit new resident form
  $('#new_resident_form').submit(function (e){
    e.preventDefault(); //prevent form submit default behaviour

    var name = $("#newResidentName").val();
    var caretaker = $("#newResidentCaretaker").val();
    var room = $("#newResidentRoom").val();
    var deviceAddr = $("#newResidentDeviceAddr").val();
    var gender = $('#newResidentGender').val();
    var dob = $("#newResidentDOB").val();
    var ic = $('#newResidentIC').val();
    var nationality = $("#newResidentNationality").val();
    var weight = $("#newResidentWeight").val();
    var height = $("#newResidentHeight").val();
    //var bloodType = $('#newResidentBloodType').val();
    var pNum = $("#newResidentPNum").val();
    var guardian = $("#newResidentGuardian").val();
    var emergencyPNum = $("#newResidentEmergencyPNum").val();
    var streetAdd = $('#newResidentStreetAddress').val();
    var streetAdd2 = $("#newResidentStreetAddress2").val();
    var city = $("#newResidentCity").val();
    var state = $("#newResidentState").val();
    var postal = $('#newResidentPostal').val();

    var validation = validationOK(name, room, deviceAddr, dob, ic, nationality, weight, height, pNum, guardian, emergencyPNum, streetAdd, streetAdd2, city, state, postal);

    if (validation){
      //send to server
      $.ajax({
        type: "POST",
        url: "api/residents/add/",
        contentType : 'application/json',
        dataType: 'json',
        beforeSend: function (xhr) {
          //include credentials
          xhr.setRequestHeader ("Authorization", "Basic " + localStorage.getItem("credentials"));
        },
        data: JSON.stringify({
          name: $("#newResidentName").val(),
          caretaker:  $("#newResidentCaretaker").val(),
          room:  $("#newResidentRoom").val(),
          deviceAddr:  $("#newResidentDeviceAddr").val().toLowerCase(),
          gender: $('#newResidentGender').val(),
          dob: $("#newResidentDOB").val(),
          ic: $('#newResidentIC').val(),
          nationality: $("#newResidentNationality").val(),
          weight: $("#newResidentWeight").val(),
          height: $("#newResidentHeight").val(),
          bloodType: $('#newResidentBloodType').val(),
          pNum: $("#newResidentPNum").val(),
          guardian: $("#newResidentGuardian").val(),
          emergencyPNum: $("#newResidentEmergencyPNum").val(),
          streetAdd: $('#newResidentStreetAddress').val(),
          streetAdd2: $("#newResidentStreetAddress2").val(),
          city: $("#newResidentCity").val(),
          state: $("#newResidentState").val(),
          postal: $('#newResidentPostal').val(),

          healthConditions: getEachHealth($('.healthConditions-new')),
          allergies: getEachHealth($('.allergies-new')),
          medication: getEachHealth($('.medication-new'))
        }),
        success: function (resident){
          //on success, clear form, modal and update list
          Toast.fire({
            icon: 'success',
            title: '  Resident Created!'
          })

          console.log("resident created: "+ resident);
          $("#new_resident_form").trigger("reset");
          $("#newResidentModal").modal('hide');
          getAllResidents();
        },
        error: function (xhr){
          var code = xhr.status;

          //handle 401
          if (code == 401){
            $("#newResidentModal").modal('hide');
            handleUnauthorized();
          }
        }
      });
    }

    //test
    //testSubmittedDataAdminResident();
  });

  //table: handle when clicking rows
  $('#residents_table tbody').on("click", "tr", function() {
    resident = residents_table.row( this ).data();

    //populate the form
    $("#residentID").val(resident._id);
    $("#residentName").val(resident.name);
    $("#residentCaretaker").val(resident.caretaker);
    $("#residentRoom").val(resident.room);
    $("#residentDeviceAddr").val(resident.deviceAddr);
    $("#residentGender").val(resident.gender);
    $("#residentDOB").val(resident.dob);
    $("#residentIC").val(resident.ic);
    $("#residentNationality").val(resident.nationality);
    $("#residentPNum").val(resident.pNum);
    $("#residentGuardian").val(resident.guardian);
    $("#residentEmergencyPNum").val(resident.emergencyPNum);
    $("#residentStreetAddress").val(resident.streetAdd);
    $("#residentStreetAddress2").val(resident.streetAdd2);
    $("#residentCity").val(resident.city);
    $("#residentState").val(resident.state);
    $("#residentPostal").val(resident.postal);

    $("#residentWeight").val(resident.weight);
    $("#residentHeight").val(resident.height);
    $("#residentBloodType").val(resident.bloodType);

    //clear divs
    $('.healthConditions').remove();
    $('.allergies').remove();
    $('.medication').remove();

    //ADDING BACK DIVSstaff
    for(i=0; i<resident.healthConditions.length; i++){
      showEachHealth(resident.healthConditions[i], 'healthConditions')
    }

    for(i=0; i<resident.allergies.length; i++){
      showEachHealth(resident.allergies[i], 'allergies')
    }

    for(i=0; i<resident.medication.length; i++){
      showEachHealth(resident.medication[i], 'medication')
    }

    $("#residentModal").modal('toggle');
  });

  //residentModal: handle modal hide
  //reset the modal state
  $('#residentModal').on('hide.bs.modal', function (e) {
    cancelUpdateResident();
  })

  //update resident
  $('#update_resident_form').submit(function (e){
    //no validate, we are blindly trusting our users
    //instead we ask them to self validate :)
    e.preventDefault(); //prevent form submit default behaviour

    var name = $("#residentName").val();
    var caretaker = $("#residentCaretaker").val();
    var room = $("#residentRoom").val();
    var deviceAddr = $("#residentDeviceAddr").val();
    var gender = $('#residentGender').val();
    var dob = $("#residentDOB").val();
    var ic = $('#residentIC').val();
    var nationality = $("#residentNationality").val();
    var weight = $("#residentWeight").val();
    var height = $("#residentHeight").val();
    //var bloodType = $('#newResidentBloodType').val();
    var pNum = $("#residentPNum").val();
    var guardian = $("#residentGuardian").val();
    var emergencyPNum = $("#residentEmergencyPNum").val();
    var streetAdd = $('#residentStreetAddress').val();
    var streetAdd2 = $("#residentStreetAddress2").val();
    var city = $("#residentCity").val();
    var state = $("#residentState").val();
    var postal = $('#residentPostal').val();

    var errorMsgs = "";

    var validation = validationOK(name, room, deviceAddr, dob, ic, nationality, weight, height, pNum, guardian, emergencyPNum, streetAdd, streetAdd2, city, state, postal);

    if (validation){
      //send to server
      $.ajax({
        type: "PUT",
        url: "api/residents/update/" + $("#residentID").val(),
        contentType : 'application/json',
        dataType: 'json',
        beforeSend: function (xhr) {
          //include credentials
          xhr.setRequestHeader ("Authorization", "Basic " + localStorage.getItem("credentials"));
        },
        data: JSON.stringify({
          name: $("#residentName").val(),
          caretaker:  $("#residentCaretaker").val(),
          room:  $("#residentRoom").val(),
          deviceAddr:  $("#residentDeviceAddr").val().toLowerCase(),
          gender: $('#residentGender').val(),
          dob: $("#residentDOB").val(),
          ic: $('#residentIC').val(),
          nationality: $("#residentNationality").val(),
          weight: $("#residentWeight").val(),
          height: $("#residentHeight").val(),
          bloodType: $('#residentBloodType').val(),
          pNum: $("#residentPNum").val(),
          guardian: $("#residentGuardian").val(),
          emergencyPNum: $("#residentEmergencyPNum").val(),
          streetAdd: $('#residentStreetAddress').val(),
          streetAdd2: $("#residentStreetAddress2").val(),
          city: $("#residentCity").val(),
          state: $("#residentState").val(),
          postal: $('#residentPostal').val(),

          healthConditions: getEachHealth($('.healthConditions')),
          allergies: getEachHealth($('.allergies')),
          medication: getEachHealth($('.medication'))
        }),
        success: function (resident){
          //on success, clear form, modal and update list
          console.log("resident updated: "+ resident);
          Toast.fire({
            icon: 'success',
            title: '  Resident Updated!'
          })

          $("#residentModal").modal('hide');
          getAllResidents();
        },
        error: function (xhr){
          var code = xhr.status;

          //handle 401
          if (code == 401){
            $("#residentModal").modal('hide');
            handleUnauthorized();
          }
        }
      });
    }

  });

  // NEW RESIDENT SIDE
  // When add btn clicked, it will add in a div with the value given by user with selected random colors
  allowAddingHealth("new-condition-new", "healthConditions-new");
  allowAddingHealth("new-allergies-new", "allergies-new");
  allowAddingHealth("new-medication-new", "medication-new");
  // END

  // EDIT RESIDENT SIDE
  allowAddingHealth("new-condition", "healthConditions");
  allowAddingHealth("new-allergies", "allergies");
  allowAddingHealth("new-medication", "medication");
  //END

  /********** functions **********/

  function handleUnauthorized(){
    $("#unauthorized_modal").modal("show");
  }

  function getAllResidents() {
    $.ajax({
      type: "GET",
      url: "api/residents/all/",
      dataType: 'json',
      beforeSend: function (xhr) {
        //include credentials
        xhr.setRequestHeader ("Authorization", "Basic " + localStorage.getItem("credentials"));
      },
      success: function (residents){
        //on success, update table

        //remap residents caretaker with caretaker name
        residents = residents.map(item => {
          item.caretakerName = caretakerList.find(staff => staff._id == item.caretaker).name;
          return item;
        });

        //clear and repopulate table
        residents_table.clear();
        residents_table.rows.add(residents);
        residents_table.draw();
      },
      error: function (xhr){
        var code = xhr.status;

        //handle 401
        if (code == 401){
          handleUnauthorized();
        }
      }
    });
  }

  function getResidentById() {
    $.ajax({
      type: "GET",
      url: "api/residents/",
      dataType: 'json',
      beforeSend: function (xhr) {
        //include credentials
        xhr.setRequestHeader ("Authorization", "Basic " + localStorage.getItem("credentials"));
      },
      success: function (resident){
        //on success, display resident details

      },
      error: function (xhr){
        var code = xhr.status;

        //handle 401
        if (code == 401){
          handleUnauthorized();
        }
      }
    });
  }

  //reset the form with confirmation and extra elements deleted
  function confirm_reset(){
    r = confirm('Are you sure? This will clear the form!');

    if(r==true){
      $('.healthConditions-new').remove();
      $('.allergies-new').remove();
      $('.medication-new').remove();
    }

    return r;
  }

  function enableUpdateResident(){
    //change title
    $("#residentModalTitle").text("Modify Resident");

    //change buttons
    $("#residentModalFooter").hide();
    $("#updateResidentFooter").show();

    //allow editing
    $("#residentName").prop("disabled", false);
    $("#residentCaretaker").prop("disabled", false);
    $("#residentRoom").prop("disabled", false);
    $("#residentDeviceAddr").prop("disabled", false);
    $("#residentGender").prop("disabled", false);
    $("#residentDOB").prop("disabled", false);
    $("#residentIC").prop("disabled", false);
    $("#residentNationality").prop("disabled", false);
    $("#residentWeight").prop("disabled", false);
    $("#residentHeight").prop("disabled", false);
    $("#residentBloodType").prop("disabled", false);
    $("#add-new-condition").prop("disabled", false);
    $("#add-new-allergies").prop("disabled", false);
    $("#add-new-medication").prop("disabled", false);
    $("#residentPNum").prop("disabled", false);
    $("#residentGuardian").prop("disabled", false);
    $("#residentEmergencyPNum").prop("disabled", false);
    $("#residentStreetAddress").prop("disabled", false);
    $("#residentStreetAddress2").prop("disabled", false);
    $("#residentCity").prop("disabled", false);
    $("#residentState").prop("disabled", false);
    $("#residentPostal").prop("disabled", false);

    $(".closeDiv").prop('disabled', function(i, v) { return !v; });

  }

  function cancelUpdateResident(){
    $("#residentModalTitle").text("Resident Details");

    //change buttons
    $("#residentModalFooter").show();
    $("#updateResidentFooter").hide();

    //disallow editing
    $("#residentName").prop("disabled", true);
    $("#residentCaretaker").prop("disabled", true);
    $("#residentRoom").prop("disabled", true);
    $("#residentDeviceAddr").prop("disabled", true);
    $("#residentGender").prop("disabled", true);
    $("#residentDOB").prop("disabled", true);
    $("#residentIC").prop("disabled", true);
    $("#residentNationality").prop("disabled", true);
    $("#residentWeight").prop("disabled", true);
    $("#residentHeight").prop("disabled", true);
    $("#residentBloodType").prop("disabled", true);
    $("#add-new-condition").prop("disabled", true);
    $("#add-new-allergies").prop("disabled", true);
    $("#add-new-medication").prop("disabled", true);
    $("#residentPNum").prop("disabled", true);
    $("#residentGuardian").prop("disabled", true);
    $("#residentEmergencyPNum").prop("disabled", true);
    $("#residentStreetAddress").prop("disabled", true);
    $("#residentStreetAddress2").prop("disabled", true);
    $("#residentCity").prop("disabled", true);
    $("#residentState").prop("disabled", true);
    $("#residentPostal").prop("disabled", true);

    $(".closeDiv").prop("disabled", true);

    //reset the data
    $("#residentName").val(resident.name);
    $("#residentCaretaker").val(resident.caretaker);
    $("#residentRoom").val(resident.room);
    $("#residentDeviceAddr").val(resident.deviceAddr);
    $("#residentGender").val(resident.gender);
    $("#residentDOB").val(resident.dob);
    $("#residentIC").val(resident.ic);
    $("#residentNationality").val(resident.nationality);
    $("#residentWeight").val(resident.weight);
    $("#residentHeight").val(resident.height);
    $("#residentBloodType").val(resident.bloodType);

    /* ALERT! CONDITION ALLERGIES AND MEDICATION
    WHEN CANCEL BTN CLICKED ALL SHOULD BE GONE
    AND REPLACED BY PREVIOUS VALUES FETCHED */
    //DELETING ALL CREATED DIVS
    $('.healthConditions').remove();
    $('.allergies').remove();
    $('.medication').remove();

    //CLEARING TEXT BOX
    $('#new-condition').val('');
    $('#new-allergies').val('');
    $('#new-medication').val('');

    //ADDING BACK DIVS
    for(i=0; i<resident.healthConditions.length; i++){
      showEachHealth(resident.healthConditions[i], 'healthConditions')
    }

    for(i=0; i<resident.allergies.length; i++){
      showEachHealth(resident.allergies[i], 'allergies')
    }

    for(i=0; i<resident.medication.length; i++){
      showEachHealth(resident.medication[i], 'medication')
    }


    $("#residentPNum").val(resident.pNum);
    $("#residentGuardian").val(resident.guardian);
    $("#residentEmergencyPNum").val(resident.emergencyPNum);
    $("#residentStreetAddress").val(resident.streetAdd);
    $("#residentStreetAddress2").val(resident.streetAdd2);
    $("#residentCity").val(resident.city);
    $("#residentState").val(resident.state);
    $("#residentPostal").val(resident.postal);
  }

  function deleteResident(){
    var confirmDeletion = confirm('Are you sure? This will remove this resident!');

    if(confirmDeletion == true){
      $.ajax({
        url: "api/residents/delete/" + $("#residentID").val(),
        type: 'DELETE',
        beforeSend: function (xhr) {
          //include credentials
          xhr.setRequestHeader ("Authorization", "Basic " + localStorage.getItem("credentials"));
        },
        success: function(result) {
          //on success, clear form, modal and update list
          Toast.fire({
            icon: 'info',
            title: 'Resident Deleted!'
          })

          $("#residentModal").modal('hide');
          console.log("resident deleted. ");
          getAllResidents();
        },
        error: function (xhr){
          var code = xhr.status;

          //handle 401
          if (code == 401){
            $("#residentModal").modal('hide');
            handleUnauthorized();
          }
        }
      });
    }
  }

  // Get random color
  function getRandomColor() {
    var colors = ['992525', '5F9925', '259999', '5F2599'];
    var color = "#"
    color += colors[Math.floor(Math.random() * colors.length)];
    return color;
  }

  function getCaretakers() {
    $.ajax({
      type: "GET",
      url: "api/users/all/",
      dataType: 'json',
      async: false, //force synchronous, as we need caretaker names before loading residents
      beforeSend: function (xhr) {
        //include credentials
        xhr.setRequestHeader ("Authorization", "Basic " + localStorage.getItem("credentials"));
      },
      success: function (staff){
        //on success, update table
        var selection = $("#newResidentCaretaker");
        var editSelection = $("#residentCaretaker");

        $.each(staff, function(key){
          //only show 'staff' roles, admin hidden
          if (staff[key].role == "staff"){
            selection.append($("<option />").val(staff[key]._id).text(staff[key].name));
            editSelection.append($("<option />").val(staff[key]._id).text(staff[key].name));
          }
        })

        //make it accessible globally
        caretakerList = staff;
      },
      error: function (xhr){
        var code = xhr.status;

        //handle 401
        if (code == 401){
          handleUnauthorized();
        }
      }
    });
  }

  // Toast
  var Toast = Swal.mixin({
    toast: true,
    position: 'top-end',
    showConfirmButton: false,
    timer: 8000,
  });

</script>

</body>
</html>
